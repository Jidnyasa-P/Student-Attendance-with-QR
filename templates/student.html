<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary shadow">
        <div class="container-fluid">
            <span class="navbar-brand">
                <i class="fas fa-user-graduate"></i> Student Dashboard
            </span>
            <div class="d-flex align-items-center">
                <span class="navbar-text text-white me-3">
                    <i class="fas fa-user"></i> <span id="username" class="fw-bold"></span>
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div id="alerts"></div>

                <div class="card shadow-lg">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-qrcode"></i> QR Code Scanner
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="text-center">
                                    <div class="scanner-container mb-3">
                                        <video id="video" autoplay muted playsinline 
                                               class="border rounded shadow-sm w-100" 
                                               style="max-width: 400px; height: 300px; object-fit: cover; background: #000;">
                                        </video>
                                        <canvas id="canvas" style="display: none;"></canvas>
                                    </div>

                                    <div class="btn-group" role="group">
                                        <button id="startScanBtn" class="btn btn-success btn-lg">
                                            <i class="fas fa-camera"></i> Start Camera
                                        </button>
                                        <button id="stopScanBtn" class="btn btn-danger btn-lg" style="display: none;">
                                            <i class="fas fa-stop"></i> Stop
                                        </button>
                                        <button id="testQRBtn" class="btn btn-info btn-lg">
                                            <i class="fas fa-vial"></i> Test QR
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div id="qrResult" style="display: none;">
                                    <div class="alert alert-success shadow-sm">
                                        <h6 class="alert-heading">
                                            <i class="fas fa-check-circle"></i> QR Code Detected!
                                        </h6>
                                        <hr>
                                        <div class="bg-light p-3 rounded border mb-3" style="max-height: 100px; overflow-y: auto;">
                                            <small id="qrData" class="font-monospace text-break"></small>
                                        </div>
                                        <button id="markAttendanceBtn" class="btn btn-primary w-100 btn-lg">
                                            <i class="fas fa-check-circle"></i> Mark My Attendance
                                        </button>
                                    </div>
                                </div>

                                <div id="instructions">
                                    <div class="alert alert-info">
                                        <h6><i class="fas fa-info-circle"></i> How to Use:</h6>
                                        <ol class="mb-0">
                                            <li>Click <strong>"Start Camera"</strong> button</li>
                                            <li>Allow camera access when prompted</li>
                                            <li>Point camera at faculty's QR code</li>
                                            <li>Wait for automatic detection</li>
                                            <li>Click <strong>"Mark Attendance"</strong> to confirm</li>
                                        </ol>
                                    </div>

                                    <div class="alert alert-warning">
                                        <h6><i class="fas fa-exclamation-triangle"></i> Important:</h6>
                                        <ul class="mb-0">
                                            <li>QR codes expire after 30 minutes</li>
                                            <li>You can only mark attendance once per session</li>
                                            <li>Use "Test QR" if camera doesn't work</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/qr-scanner.js"></script>
</body>
</html>